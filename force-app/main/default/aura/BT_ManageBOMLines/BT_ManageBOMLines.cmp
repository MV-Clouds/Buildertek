<aura:component controller="ManageBOMlinesController" implements="force:appHostable,flexipage:availableForAllPageTypes,flexipage:availableForRecordHome,force:hasRecordId,forceCommunity:availableForAllPageTypes,force:lightningQuickActionWithoutHeader,lightning:isUrlAddressable" 
                access="global">

    <aura:attribute name="Spinner" type="Boolean" />
    <aura:attribute name="fieldmaptype" type="Object" />
    <aura:attribute name="islocked" type="boolean" default="false" />
    <aura:attribute name="message" type="String" default="" />
    <aura:if isTrue="{!v.islocked}">
        <div class="" >
            <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
                <p><center style=" font-size: medium ">{!v.message}</center>
                </p>
            </div>
            <br/>
        </div>
        
    </aura:if>
    <!--pagination-->
    
    
    <aura:attribute name="PageNumber" type="integer" default="1" />
    <aura:attribute name="pageSize" type="integer" default="10" />
    <aura:attribute name="TotalPages" type="integer" default="0" />
    <aura:attribute name="TotalRecords" type="integer" default="0" />
    <aura:attribute name="RecordStart" type="integer" default="0" />
    <aura:attribute name="RecordEnd" type="integer" default="0" /> 
    <!-- end -->

    <!--search -->
    <aura:attribute name="searchVendorFilter" type="String" default="" />
    <aura:attribute name="searchCategoryFilter" type="String" default="" />
    <aura:attribute name="searchTradeTypeFilter" type="String" default="" />
    <aura:attribute name="searchBuildPhaseFilter" type="String" default="" />
    <aura:attribute name="searchProductTypeFilter" type="String" default="" />
    <aura:attribute name="searchPurchaseOrderFilter" type="String" default="" />
    
    <aura:handler name="change" value="{!v.searchVendorFilter}" action="{!c.doSearch}" />
    <aura:handler name="change" value="{!v.searchCategoryFilter}" action="{!c.doSearch}" />
    <aura:handler name="change" value="{!v.searchTradeTypeFilter}" action="{!c.doSearch}" />
    <aura:handler name="change" value="{!v.searchBuildPhaseFilter}" action="{!c.doSearch}" />
    <aura:handler name="change" value="{!v.searchProductTypeFilter}" action="{!c.doSearch}" />
    <aura:handler name="change" value="{!v.searchPurchaseOrderFilter}" action="{!c.doSearch}" />
    
    <aura:handler name="change" value="{!v.dynamicFilterValue}" action="{!c.doSearch}" />
    <!-- end -->
    
    
    <aura:attribute name="selectedRecords" type="List" default="[]" />
    <aura:attribute name="JselectedRecordsIds" type="List" default="[]" />
    <aura:attribute name="recordsList" type="List" default="[]" />
    <aura:attribute name="orgData" type="Object" />
    <aura:attribute name="data" type="Object" />
    <aura:attribute name="columns" type="List" />
    
    <aura:attribute name="defaultSortDirection" type="String" default="asc" />
    <aura:attribute name="sortedBy" type="String" default=""/>
    <aura:attribute name="sortDirection" type="String" default="" />
    <aura:attribute name="sortingGroupIndex" type="Integer" default="-1" />
    
    <aura:attribute name="selectedTableRows" type="List"  />
    <aura:attribute name="selectedTableRowIds" type="List" />
    <aura:attribute name="selectedRows" type="List" />
    <aura:attribute name="dataByGroup" type="Object" />
    <aura:attribute name="cloneDataByGroup" type="Object" />
    <aura:attribute name="dataGroupByVendor" type="Object" />
    <aura:attribute name="selectedRecordMap" type="Object" />
    <aura:attribute name="selectedRowsByGroupMap" type="Object" />
    <aura:attribute name="vendors" type="List" />
    <aura:attribute name="selectedRowIndex" type="List" default="[]"/>
    
    <!-- BOM Line -->
    <aura:attribute name="fieldBOMLineNameApiMap" type="Map"  />	
    <aura:attribute name="fieldBOMLineNameApiList" type="List"  />	
    
    <!-- dynamic BOM Line filed -->
    <aura:attribute name="bomLineFieldsSettings" type="List" default="[]" />	
    <aura:attribute name="bomLineListTmp" type="List" default="[]" />     
    <aura:attribute name="bomLineselectedFields" type="String" />  
    
    <aura:attribute name="groupByPhasetoggle" type="Boolean" default="true"/>
    <aura:attribute name="groupByVendortoggle" type="Boolean" default="false"/>
    <aura:attribute name="groupByCategorytoggle" type="Boolean" default="false"/>
    <aura:attribute name="groupByServiceCategorytoggle" type="Boolean" default="false"/>
    <aura:attribute name="groupBytoggle" type="Boolean" default="false" />
    
    <aura:handler name="init" value="{!this}" action="{!c.doInit}" /> 
    <aura:attribute name="showMessage" type="Boolean" default="false" />
    <aura:attribute name="showModal" type="Boolean" default="false" />
    <aura:attribute name="vendorList" type="Object" />
    <aura:attribute name="projectName" type="String" default=""/>
    <aura:attribute name="projectId" type="String" />
    <aura:attribute name="selectedVendor" type="String" default="" />
    <aura:attribute name="optionLineId" type="String" default="" />
    <aura:attribute name="BOMName" type="String" default=""/>
    <aura:attribute name="isDeletetakeoffLines" type="Boolean" default="false" />
    <aura:attribute name="storeId" type="String" default=""/>
    <aura:attribute name="opportunityName" type="String" default=""/>
    <aura:attribute name="opportunityId" type="String" />
    
    <!-- mass update -->
    <aura:attribute name="massUpdateEnable" type="Boolean" default="true" />
    <aura:attribute name="listOfRecords" type="Select_Sheet__c[]" />
    <aura:attribute name="cloneListOfRecords" type="Select_Sheet__c[]" />
    <aura:attribute name="fieldValues" type="List" />
    <aura:attribute name="quoteLineName" type="String" />
    <aura:attribute name="isModalOpen" type="Boolean" />
    <aura:attribute name="selectedRecordIndex" type="Integer" />
    <aura:attribute name="isLoading" type="Boolean" default="false" />    
    <lightning:workspaceAPI aura:id="workspace" />
    <aura:attribute name="sObjectRecords" type="List" default="[]" />
    
    <!--Fabrication Taxes-->
    <aura:attribute name="showBTAdminButton" type="Boolean" default="false"  />
    <aura:attribute type="object" name="bomList"/>   
    <aura:attribute name="showCountryModal" type="Boolean" default="false"  />
    <aura:attribute name="bomId" type="String" />
    <aura:attribute name="showAdjustmentTable" type="Boolean" default="false"  />
    <aura:attribute name="groupByBuildChecked" type="Boolean" default="false"  />
    <aura:attribute name="adjustmentTableColumns" type="List"/>
    <aura:attribute name="showFabricationDetails" type="Boolean" default="false"  />
    <aura:attribute name="totalExtendedCost" type="String" />
    <aura:attribute name="totalGrossCost" type="String" />
    <aura:attribute name="totalDiscountPercent" type="String" />
    <aura:attribute name="totalDiscountAmount" type="String" />
    <aura:attribute name="totalMarkupPercent" type="String" />
    <aura:attribute name="totalMarkupAmount" type="String" />
    <aura:attribute name="totalSubTotalAmount" type="String" />
    <aura:attribute name="totalSalesTax" type="String" />
    <aura:attribute name="totalAmount" type="String" />
    <aura:attribute name="totalProposalBaseCost" type="String" />
    <aura:attribute name="totalProposalBaseValue" type="String" />

    <aura:attribute name="bomLineFieldsSettingsClone" type="List" default="[]" />
    <aura:attribute name="countryoptions" type="List" default="[]"/>
    <aura:attribute name="selectedCountry" type="String" />
    <aura:attribute name="selectedCountryDB" type="String" default="Please Select a Country" />
    <aura:attribute name="showProductCodeModal" type="Boolean" default="false"  />
    <aura:attribute type="String" name="fieldAPINameToPass"/>
    <aura:attribute type="String" name="fieldLabelToShow"/>
    <aura:attribute type="object" name="fabInstallExtndCost"/>
    <aura:attribute type="object" name="installOnlyExtndCost"/>
    <aura:attribute type="object" name="nonSlabExtndCost"/>
    <aura:attribute type="object" name="fabOnlyExtndCost"/>
    <aura:attribute type="object" name="miscExtndCost"/>
    <aura:attribute type="object" name="edgeCost"/>
    <aura:attribute type="object" name="slabDiscountRate"/>
    <aura:attribute type="object" name="fabLaborMarkupRate"/>
    <aura:attribute type="object" name="OptionsExtndCost"/>
    <aura:attribute type="String" name="generalLiabilityCost"/>
    <aura:attribute type="String" name="workersCompCost"/>
    <aura:attribute type="String" name="texturaFeeCost"/>
    <aura:attribute type="String" name="recordId"/>
    <aura:attribute name="openCreateProposalModal" type="Boolean" default="false"  />
    <aura:attribute name="adjustCostUpdated" type="Boolean" default="false"  />
    <aura:attribute name="servCatVsExtendedCostMap" type="List"  />
    <aura:attribute name="totalInstallCost" type="String" />
    <aura:attribute name="totalProposalAmount" type="String" />
    <aura:attribute name="buildPhaseName" type="String"/>

    <aura:attribute name="EditRecordId" type="String" />
    <aura:attribute name="OpenEditPopup" type="Boolean" default="false" />
    <aura:attribute name="listOfFields" type="List" />

    <aura:attribute name="record" type="Object" />
    <aura:attribute name="BTBOMtype" type="Object" />
    <aura:attribute name="totalBOMlines" type="Integer" />
    <aura:attribute name="massupdateIndex" type="List" />
    
    <lightning:navigation aura:id="goToPrevious" />

    <force:recordData aura:id="recordLoader"
                recordId="{!v.recordId}"
                fields="Name"
                targetRecord="{!v.record}"
                targetFields="{!v.BTBOMtype}"
                targetError="{!v.recordError}"
                recordUpdated="{! c.handleRecordLoaded }"/>

    <div>
        <div class="slds-card">
            <div class="slds-grid slds-gutters cardCss slds-wrap">
                <div class="slds-col slds-size_6-of-8" >
                    <span>
                        <span style=" color: #6b6d70;">BOM</span>
                        <h2 class="slds-card__header-title">
                            <span onclick="{!c.redirect}" style="color:#0176d3;cursor:pointer;"><!-- #0176d3 -->
                                {!v.BOMName}
                            </span>
                        </h2>
                    </span>
                </div>
                <div class="slds-col slds-size_2-of-8" style="text-align: right;">
                    <lightning:button iconName="utility:back" iconPosition="left" onclick="{!c.redirect}" label="Back" class="" />
                </div>
                
            </div>
        </div>

        <div class="searchCointainer" style="background: var(--lwc-pageHeaderColorBackground, rgb(243, 242, 242));padding: 2rem 1rem;overflow-x: auto;white-space: nowrap; margin-top: 8px; border-radius: 4px;">
        <aura:iteration items="{!v.dataByGroup}" var="groupItem" indexVar="groupIndex">
            <div class="slds-grid slds-gutters slds-wrap" style="border-block: 2px solid #dddbda; margin: 15px 0px!important; padding-block: 6px; background: white;">
                <div class="slds-modal__header slds-p-around_xx-small GroupHeader slds-col slds-size_6-of-8" style="font-size:18px; border-block: 0px !important;font-weight:bold;">
                    <div style="flex: 1;">
                        {!groupItem.groupName}
                    </div>
                </div>
                <div class="slds-col slds-size_2-of-8" style="text-align: right;">
                    <lightning:button iconName="utility:save" title="{!groupIndex}" iconPosition="left" onclick="{!c.massUpdateLines}"
                    label="{!groupItem.massUpdate==true?'Save':'Mass Update'}" class="" />
                    <aura:if isTrue="{!groupItem.massUpdate}">
                        <lightning:button iconName="utility:close" title="{!groupIndex}" iconPosition="left" onclick="{!c.onMassUpdateCancel}" label="Cancel" />
                    </aura:if>
                </div>
            </div>
            <!-- </div>  -->
            <div id="{!groupItem.groupName+'_'+groupIndex}" class="customDataTable" style="overflow-y:auto;overflow-x:scroll;"><!-- aura:id = "tableByGroup" aura:id="poTable"-->
                <aura:if isTrue="{!groupItem.massUpdate}">
                    <div style = "background-color:white;" >
                        <table  class="slds-table slds-table--bordered" style="width: max-content; max-width: 200%;">
                            <thead>
                                <tr style="{!groupItem.massUpdate ? '':''}">
                                    <th scope="col" tabindex="-1" aria-label="Row Number" style="width: 52px;">
                                        <div class="slds-cell-fixed" style="width: 52px; outline: none;">
                                            <span class="slds-th__action"><span title="Row Number" class="slds-truncate">
                                                </span></span>
                                        </div>
                                    </th>
                                    <aura:iteration items="{!v.bomLineFieldsSettings}" var="rec" indexVar="SettingsIndex">
                                        <aura:if isTrue="{!or(rec.label == 'Build Phase',rec.label == 'List Price')}">
                                           <th style="padding-right:3.1rem;"> &nbsp;{!rec.label} </th>
                                            <aura:set attribute="else">
                                               <th> &nbsp;{!rec.label}</th>
                                            </aura:set>
                                        </aura:if>
                                    </aura:iteration>
                                    <!-- <aura:if isTrue="{!groupItem.massUpdate}">
                                        <th class="slds-is-sortable slds-text-title-+-caps" scope="col" style="width:4%;">
                                            <span class="slds-truncate"></span>
                                        </th>
                                    </aura:if> -->
                                </tr>
                            </thead>
                            <tbody>
                                <aura:iteration  items="{!groupItem.sObjectRecordsList}" var="row" indexVar="index">
                                    <tr>
                                        <td role="gridcell" tabindex="-1">
                                            <span class="slds-grid slds-grid_align-spread">
                                                <div class="slds-truncate">
                                                    {!index+1}
                                                </div>
                                            </span>
                                        </td>
                                        <aura:iteration items="{!v.fieldValues}" var="field">
                                            <aura:if isTrue="{!(field.label == 'Standard?')}">
                                                <td>
                                                    <c:BT_FieldSetMassUpdate record="{!row}" index="{!index}" field="{!field}"
                                                                             isMassUpdateEnable="{!groupItem.massUpdate}"
                                                                             childObjectName="buildertek__Select_Sheet__c"
                                                                             ObjectName="buildertek__Select_Sheet__c"
                                                                             callingCmpName="BT_ManageBOMLines"/>
                                                    
                                                </td> 
                                                <aura:set attribute="else">
                                                    <aura:if isTrue="{!(field.name == 'buildertek__Total_Sales_Price__c')}">
                                                        <td style = "padding-right:5px; width: 7rem;" > 
                                                            <lightning:input value="{!row.buildertek__Total_Sales_Price__c}" type="number" formatter="currency" name="{!field.name}" variant="label-hidden" disabled="true" width="50%"/>
                                                        </td>
                                                        <aura:set attribute="else"> 
                                                            <aura:if isTrue="{! or( or(field.type == 'DOUBLE',field.type == 'CURRENCY'), field.type == 'PERCENT') }">
                                                                
                                                                <td style = "padding-right:5px; width: 7rem;" > 
                                                                    <c:BT_FieldSetMassUpdate record="{!row}" index="{!index}" field="{!field}"
                                                                                            isMassUpdateEnable="{!groupItem.massUpdate}"
                                                                                            childObjectName="buildertek__Select_Sheet__c" 
                                                                                            ObjectName="buildertek__Select_Sheet__c"
                                                                                            callingCmpName="BT_ManageBOMLines"/>
                                                                </td>
                                                                <aura:set attribute="else">
                                                                    <td>  
                                                                    <!-- <aura:if isTrue="{!field.name == 'buildertek__Takeoff_Line__c'}">
                                                                        <lightning:recordEditForm onload="{!c.recordEditLoaded}" recordId="{!row.Id}" objectApiName="buildertek__Select_Sheet__c">
                                                                            <div style = "padding-top: 7px !important; padding-bottom: 0px !important;">
                                                                                <lightning:inputField aura:id="lookupField" fieldName="{!field.name}" value="{!row.buildertek__Takeoff_Line__c}" 
                                                                                />  
                                                                            </div> 
                                                                        </lightning:recordEditForm>
                                                                    <aura:set attribute="else">
                                                                        <aura:if isTrue="{!field.name == 'buildertek__BT_Price_Book__c'}">
                                                                            <lightning:recordEditForm recordId="{!row.Id}" objectApiName="buildertek__Select_Sheet__c}">
                                                                                <div style = "padding-top: 7px !important; padding-bottom: 0px !important;">
                                                                                    <lightning:inputField aura:id="lookupField" fieldName="{!field.name}" value="{!row.buildertek__BT_Price_Book__c}" 
                                                                                    />  
                                                                                </div> 
                                                                            </lightning:recordEditForm>
                                                                            <aura:set attribute="else"> -->
                                                                                <c:BT_FieldSetMassUpdate record="{!row}" index="{!index}" field="{!field}"
                                                                                                        isMassUpdateEnable="{!groupItem.massUpdate}"
                                                                                                        childObjectName="buildertek__Select_Sheet__c" 
                                                                                                        ObjectName="buildertek__Select_Sheet__c"
                                                                                                        callingCmpName="BT_ManageBOMLines"/>
                                                                            <!-- </aura:set>
                                                                        </aura:if>
                                                                    </aura:set>
                                                                    </aura:if> -->
                                                                    </td>
                                                                </aura:set>
                                                            </aura:if>
                                                            
                                                            
                                                        </aura:set>
                                                        </aura:if>
                                                </aura:set>
                                            </aura:if> 
                                            
                                            
                                        </aura:iteration>
                                        
                                        <td>
                                        </td>
                                    </tr>
                                </aura:iteration>

                                <!-- <aura:iteration  items="{!groupItem.sObjectRecordsList}" var="row" indexVar="index">
                                    <lightning:recordEditForm recordId="{!row.Id}" objectApiName="buildertek__Select_Sheet__c">
                                        <tr>
                                            <aura:iteration items="{!v.fieldValues}" var="field">
                                                <td>
                                                    <lightning:inputField fieldName="{!field.name}" aura:id="inputFields"/>
                                                </td>
                                            </aura:iteration>
                                        </tr>
                                    </lightning:recordEditForm>
                                </aura:iteration> -->
                            </tbody>
                        </table>
                    </div>
                    <aura:set attribute="else">
                        <table class="slds-table slds-table--bordered">
                            <thead>
                                <tr class="slds-line-height_reset">
                                    <th scope="col" tabindex="-1" aria-label="Row Number" style="width: 52px;">
                                        <div class="slds-cell-fixed" style="width: 52px; outline: none;">
                                            <span><span title="Row Number" class="slds-truncate">
                                                </span></span>
                                        </div>
                                    </th>
                                    <!-- <th class="" scope="col" style="width:2rem">
                                        <span id="column-group-header" class="slds-assistive-text">Choose a row</span>
                                        <div class="slds-th__action slds-th__action_form">
                                            <div class="slds-checkbox">
                                                <input type="checkbox" name="options" class="{!'checkSelectAll_'+groupIndex}"
                                                        id="{!'checkbox-group_'+groupIndex}" value="checkbox-unique-id-293" tabindex="0"
                                                        aria-labelledby="check-select-all-label column-group-header"
                                                        onchange="{!c.selectAll}" />
                                                <label class="slds-checkbox__label" for="{!'checkbox-group_'+groupIndex}"
                                                        id="{!'check-select-all-label-group_'+groupIndex}">
                                                    <span class="slds-checkbox_faux"></span>
                                                    <span class="slds-form-element__label slds-assistive-text">Select All</span>
                                                </label>
                                            </div>
                                        </div>
                                    </th>
                                    <th scope="col" style="width:2rem;"></th>
                                    <th scope="col" style="width:2rem;"></th> -->
                                    <aura:iteration items="{!v.bomLineFieldsSettings}" var="rec" indexVar="SettingsIndex">
                                        <th aria-label="Name" aria-sort="none" class="slds-is-resizable slds-is-sortable" scope="col"
                                            data-sortBy="{!rec.value}" name="{!rec.value}" data-sortGroupIndex="{!groupIndex}" onclick="{!c.handleSort}" title="{!rec.value}">
                                            <div data-sortBy="{!rec.value}" name="{!rec.value}" style="display: none;">{!rec.label}</div>
                                            <a data-sortBy="{!rec.value}" style="display: flex; justify-content: start; padding-block: 6px;" name="{!rec.value}" class="slds-text-link_reset" href="#" role="button" tabindex="0">
                                                <span class="slds-assistive-text">Sort by: </span>
                                                <div class="slds-grid slds-grid_vertical-align-center"
                                                        style="">
                                                    <span class="slds-truncate" title="{!rec.label}">{!rec.label}</span>
                                                    <aura:if isTrue="{!groupIndex == v.sortingGroupIndex}">
                                                        <aura:if isTrue="{!and(v.sortDirection == 'asc',v.sortedBy == rec.value)}">
                                                            <span
                                                                    class="slds-icon_container slds-is-sortable__icon slds-icon-utility-arrowdown">
                                                                <lightning:icon iconName="utility:arrowdown" alternativeText="arrowDown"
                                                                                size="xx-small" title="xx-small size" />
                                                            </span>
                                                        </aura:if>
                                                        <aura:if isTrue="{!and(v.sortDirection == 'desc',v.sortedBy == rec.value)}">
                                                            <span
                                                                    class="slds-icon_container slds-is-sortable__icon slds-icon-utility-arrowup">
                                                                <lightning:icon iconName="utility:arrowup" alternativeText="arrowup"
                                                                                size="xx-small" title="xx-small size" />
                                                            </span>
                                                        </aura:if>
                                                        <aura:if isTrue="{!v.sortedBy != rec.value}">
                                                            <span
                                                                    class="slds-icon_container slds-is-sortable__icon slds-icon-utility-arrowdown">
                                                                <lightning:icon iconName="utility:arrowup" alternativeText="arrowup"
                                                                                size="xx-small" title="xx-small size" />
                                                            </span>
                                                        </aura:if>
                                                        <aura:set attribute="else">
                                                            <span
                                                                    class="slds-icon_container slds-is-sortable__icon slds-icon-utility-arrowdown">
                                                                <lightning:icon iconName="utility:arrowup" alternativeText="arrowup"
                                                                                size="xx-small" title="xx-small size" />
                                                            </span>
                                                        </aura:set>
                                                    </aura:if>
                                                </div>
                                            </a>
                                            <div class="slds-resizable">
                                                <input type="range" aria-label="Name column width"
                                                        class="slds-resizable__input slds-assistive-text" id="cell-resize-handle-533" max="1000"
                                                        min="20" tabindex="0" />
                                                <span class="slds-resizable__handle">
                                                    <span class="slds-resizable__divider"></span>
                                                </span>
                                            </div>
                                        </th>
                                    </aura:iteration>
                                </tr>

                            </thead>
                            <tbody>
                                <aura:iteration items="{!groupItem.sObjectRecordsList}" var="row" indexVar="dataIndex">
                                    <tr>
                                        <td role="gridcell" tabindex="-1">
                                            <span class="slds-grid slds-grid_align-spread">
                                                <div class="slds-truncate">
                                                    {!dataIndex+1}
                                                </div>
                                            </span>
                                        </td>
                                        
                                        <aura:iteration items="{!v.fieldValues}" var="field" indexVar="columnIndex">
                                            <aura:if isTrue="{!field.name == 'Name'}">
                                                <td>
                                                    <ui:outputURL value="{!'/one/one.app?#/sObject/'+ row.Id + '/view'}"
                                                                        label="{!row.Name}" />
                                                </td>
                                                <aura:set attribute="else">
                                                    <aura:if isTrue="{!(field.label == 'Standard?')}">
                                                        <td>
                                                            
                                                            <c:BT_FieldSetMassUpdate record="{!row}" index="{!index}" field="{!field}"
                                                                                     isMassUpdateEnable="{!groupItem.massUpdate}"
                                                                                     childObjectName="buildertek__Select_Sheet__c"
                                                                                     ObjectName="buildertek__Select_Sheet__c"
                                                                                     callingCmpName="BT_ManageBOMLines"/>
                                                            
                                                        </td> 
                                                        <aura:set attribute="else"> 
                                                            <aura:if isTrue="{! or( or(field.type == 'DOUBLE',field.type == 'CURRENCY'), field.type == 'PERCENT') }">
                                                                
                                                                <td style = "padding-right:5px; padding-left: 16px;" > 
                                                                    <c:BT_FieldSetMassUpdate record="{!row}" index="{!index}" field="{!field}"
                                                                                             isMassUpdateEnable="{!groupItem.massUpdate}"
                                                                                             childObjectName="buildertek__Select_Sheet__c" 
                                                                                             ObjectName="buildertek__Select_Sheet__c"
                                                                                             callingCmpName="BT_ManageBOMLines"/>
                                                                </td>
                                                                <aura:set attribute="else">
                                                                    <td>  
                                                                        <c:BT_FieldSetMassUpdate record="{!row}" index="{!index}" field="{!field}"
                                                                                                    isMassUpdateEnable="{!groupItem.massUpdate}"
                                                                                                    childObjectName="buildertek__Select_Sheet__c" 
                                                                                                    ObjectName="buildertek__Select_Sheet__c"
                                                                                                    callingCmpName="BT_ManageBOMLines"/>
                                                                    </td>
                                                                </aura:set>
                                                            </aura:if>
                                                            
                                                            
                                                        </aura:set>
                                                    </aura:if> 
                                                </aura:set>
                                            </aura:if>
                                        </aura:iteration>
                                    </tr>
                                </aura:iteration>
                            </tbody>
                            <!-- <tbody>
                                <aura:iteration items="{!groupItem.groupedRecordsTmp}" var="recordData" indexVar="dataIndex">
                                    <tr>
                                        <td role="gridcell" tabindex="-1">
                                            <span class="slds-grid slds-grid_align-spread">
                                                <div class="slds-truncate">
                                                    {!dataIndex+1}
                                                </div>
                                            </span>
                                        </td>
                                        
                                        <aura:iteration items="{!recordData}" var="columnValue" indexVar="columnIndex">
                                            <aura:if isTrue="{!(columnValue.Key != 'Id')}">
                                                <aura:if isTrue="{!(columnValue.Key == 'Name')}">
                                                    
                                                    <td class="slds-truncate">
                                                        <a href="{!'/'+columnValue.Id}" data-name="{!columnValue.Id}">
                                                            {!columnValue.Value}
                                                        </a>
                                                    </td>
                                                    <aura:set attribute="else">
                                                        <aura:if isTrue="{!(columnValue.fieldType == 'CURRENCY')}">
                                                            <td>
                                                                <aura:if isTrue="{!(columnValue.Key == 'buildertek__Discount_Amount')}">
                                                                    <lightning:formattedNumber value="{!columnValue.Value}" currencyDisplayAs="code" currencyCode="USD" style="currency" class="slds-text-color_destructive"/>
                                                                    <aura:set attribute="else">
                                                                        <lightning:formattedNumber value="{!columnValue.Value != '' ? columnValue.Value : '0'}" currencyDisplayAs="code" currencyCode="USD" style="currency"/>
                                                                    </aura:set>
                                                                </aura:if>
                                                            </td>
                                                            <aura:set attribute="else">
                                                                <aura:if isTrue="{!(columnValue.fieldType == 'PERCENTAGE')}">
                                                                    <td>
                                                                        <aura:if isTrue="{!(columnValue.Key == 'buildertek__Discount')}">
                                                                            <lightning:formattedNumber value="{!columnValue.Value/100}"
                                                                                style="percent" maximumFractionDigits="2"
                                                                                minimumFractionDigits="2" step="0.1" class="slds-text-color_destructive"/>
                                                                            <aura:set attribute="else">
                                                                                <lightning:formattedNumber value="{!columnValue.Value/100}"
                                                                                                    style="percent" maximumFractionDigits="2"
                                                                                                    minimumFractionDigits="2" step="0.1" />
                                                                            </aura:set>
                                                                        </aura:if>
                                                                    </td>
                                                                    <aura:set attribute="else">
                                                                        <td>
                                                                            <aura:if
                                                                                        isTrue="{!(columnValue.Key == 'buildertek__Purchase_Order__r')}">
                                                                                <a href="{!'/'+columnValue.Id}"
                                                                                    data-name="{!columnValue.Id}">
                                                                                    {!columnValue.Value}
                                                                                </a>
                                                                                <aura:set attribute="else">
                                                                                        <aura:if isTrue="{!columnValue.Value != ''}">
                                                                                            {!columnValue.Value}
                                                                                            <aura:set attribute="else">
                                                                                                
                                                                                            </aura:set>
                                                                                        </aura:if>
                                                                                </aura:set>
                                                                            </aura:if>
                                                                        </td>
                                                                    </aura:set>
                                                                </aura:if>
                                                                
                                                            </aura:set>
                                                        </aura:if>
                                                        
                                                    </aura:set>
                                                </aura:if>
                                            </aura:if>
                                        </aura:iteration>
                                    </tr>
                                </aura:iteration>
                            </tbody> -->
                        </table>
                    </aura:set>
                </aura:if>
            </div>

        </aura:iteration>
    </div>
    </div>   


    <aura:if isTrue="{!v.isLoading}">
        <!-- <lightning:spinner alternativeText="Loading" variant="brand" size="large" /> -->
        <div aura:id="spinnerId" class="slds-spinner_container" style="position:fixed;">
            <div class="slds-spinner--brand  slds-spinner slds-spinner--large slds-is-relative" role="alert">
                <span class="slds-assistive-text">Loading</span>
                <div class="slds-spinner__dot-a"></div>
                <div class="slds-spinner__dot-b"></div>
                <div class="custom-loading-text">
                    <b>Processing, Please Wait</b>
                </div>
            </div>
        </div>
    </aura:if>

</aura:component>